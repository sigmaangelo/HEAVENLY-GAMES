<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
